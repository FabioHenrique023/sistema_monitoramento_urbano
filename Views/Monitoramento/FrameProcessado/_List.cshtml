@using sistema_monitoramento_urbano.Models.Repositorio.Entidades
@using System.Collections.Generic
@{
    var frames = ViewBag.FramesProcessados as IEnumerable<FrameProcessado> ?? Enumerable.Empty<FrameProcessado>();
    var frameTokenDict = ViewBag.FrameTokenDict as Dictionary<int, string?> ?? new Dictionary<int, string?>();
}
<div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
  <table class="min-w-full text-sm">
    <thead class="bg-gray-50 text-gray-700 font-semibold">
      <tr>
        <th class="px-4 py-3 text-left">Id</th>
        <th class="px-4 py-3 text-left">Caminho da Imagem</th>
        <th class="px-4 py-3 text-left">Criado em</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray-100">
    @if (frames == null || !frames.Any())
    {
      <tr>
        <td colspan="4" class="px-4 py-6 text-center text-gray-500">Nenhum frame processado.</td>
      </tr>
    }
    else
    {
      foreach (dynamic f in frames)
      {
        var frameId = (int)f.id;
        string? frameUrl = null;
        if (frameTokenDict.TryGetValue(frameId, out var urlToken) && !string.IsNullOrWhiteSpace(urlToken))
        {
          frameUrl = urlToken;
        }
        else
        {
          frameUrl = f.caminho_imagem;
        }
        
        <tr class="hover:bg-gray-50">
          <td class="px-4 py-3 font-medium text-gray-900">@f.id</td>
          <td class="px-4 py-3">
            @if (!string.IsNullOrWhiteSpace(frameUrl))
            {
              <a href="@frameUrl" target="_blank" class="text-indigo-700 hover:underline break-all">@f.caminho_imagem</a>
            }
            else
            {
              <span class="text-gray-400">-</span>
            }
          </td>
          <td class="px-4 py-3">@f.created_at.ToString("dd/MM/yyyy HH:mm")</td>
        </tr>
      }
    }
    </tbody>
  </table>
</div>
